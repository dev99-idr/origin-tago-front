{"version":3,"file":null,"sources":["../src/composite-subscription.js","../src/component.js","../src/variable.js","../src/to-variable.js","../src/view-model.js"],"sourcesContent":["import { Subscription } from 'rxjs-es/Subscription'\n\nSubscription.prototype.with = function(subscription) {\n  subscription.add(this)\n  return this\n}\n","import { Observable } from 'rxjs-es/Observable'\nimport { Subscription } from 'rxjs-es/Subscription'\nimport h from 'virtual-dom/h'\nimport diff from 'virtual-dom/diff'\nimport patch from 'virtual-dom/patch'\nimport createElement from 'virtual-dom/create-element'\n\nimport './composite-subscription'\nimport 'element-closest'\nimport 'rxjs-es/add/observable/of'\nimport 'rxjs-es/add/observable/fromEvent'\nimport 'rxjs-es/add/operator/share'\n\nclass DOMComponent {\n  constructor(el) {\n    this.el = el\n    this.children = []\n    this.events = {}\n    this.subscription = new Subscription\n  }\n\n  addChild(child) {\n    this.children.push(child)\n    child.parent = this\n    child.didMoveToParent && child.didMoveToParent(this)\n  }\n\n  on(eventName, selector) {\n    if (!this.events[eventName]) {\n      this.events[eventName] = Observable.fromEvent(this.el, eventName).share()\n    }\n\n    if (selector) {\n      return this.events[eventName]\n        .filter(e => {\n          const el = e.target\n          if (typeof selector === 'string') {\n            return el.closest(selector)\n          } else {\n            return el === selector\n          }\n        })\n    } else {\n      return this.events[eventName]\n    }\n  }\n\n  dispose() {\n    this.children.forEach(child => {\n      if (child.dispose) {\n        child.dispose()\n        child.parent = null\n      }\n    })\n    this.children = null\n\n    if (this.vm) {\n      this.vm.unsubscribe()\n      this.vm = null\n    }\n    this.subscription.unsubscribe()\n    this.subscription = null\n  }\n}\n\nclass VirtualDOMComponent extends DOMComponent {\n  bindDOM(bindElement) {\n    let tree = null\n    let node = null\n\n    this.renderSubscription = this.render()\n      .subscribe(newTree => {\n        if (tree) {\n          const patches = diff(tree, newTree)\n          node = patch(node, patches)\n          tree = newTree\n        } else {\n          tree = newTree\n          node = createElement(tree, { document: window.document })\n          const el = bindElement || this.el\n          el.innerText = ''\n          el.appendChild(node)\n        }\n      })\n  }\n\n  unbindDOM() {\n    if (this.renderSubscriptino) {\n      this.renderSubscription.unsubscribe()\n      this.renderSubscription = null\n    }\n  }\n\n  render() {\n    return Observable.of(h('div'))\n  }\n\n  dispose() {\n    super.dispose()\n    this.unbindDOM()\n  }\n}\n\nexport { DOMComponent, VirtualDOMComponent }\n","import { BehaviorSubject } from 'rxjs-es/BehaviorSubject'\n\nclass Variable {\n  constructor(value, source) {\n    this.subject = new BehaviorSubject(value)\n    if (source) {\n      this.sourceDisposable = source.subscribe(v => this.value = v)\n    }\n  }\n\n  get value() {\n    return this.subject.value\n  }\n\n  set value(newValue) {\n    this.subject.next(newValue)\n  }\n\n  get isUnsubscribed() {\n    return this.subject.isUnsubscribed\n  }\n\n  get observable() {\n    return this.subject\n  }\n\n  next(value) {\n    this.subject.next(value)\n  }\n\n  error(error) {\n    this.subject.error(error)\n  }\n\n  complete() {\n    this.subject.complete()\n  }\n\n  unsubscribe() {\n    if (this.sourceDisposable) {\n      this.sourceDisposable.unsubscribe()\n    }\n    this.subject.complete()\n  }\n}\n\nexport default Variable\n","import { Observable } from 'rxjs-es/Observable'\nimport Variable from './variable'\n\nfunction toVariable(initialValue) {\n  return new Variable(initialValue, this)\n}\n\nObservable.prototype.toVariable = toVariable\n","import Variable from './variable'\nimport './to-variable'\n\nclass ViewModel {\n  constructor(attrs={}) {\n    this.keys = Object.keys(attrs)\n    for (const key in attrs) {\n      this[key] = new Variable(attrs[key])\n    }\n  }\n\n  unsubscribe() {\n    for (let k in this) {\n      if (this.hasOwnProperty(k)) {\n        if (typeof this[k].dispose === 'function') {\n          this[k].unsubscribe()\n        }\n      }\n    }\n  }\n}\n\nexport default ViewModel\n"],"names":["Subscription","Observable","BehaviorSubject"],"mappings":";;;;;;;;;;;AAEAA,mCAAa,SAAb,CAAuB,IAAvB,GAA8B,UAAS,YAAT,EAAuB;AACnD,EAAA,eAAa,GAAb,CAAiB,IAAjB;AACA,EAAA,SAAO,IAAP;AACD,EAAA,CAHD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MCWM;AACJ,EAAA,wBAAY,EAAZ,EAAgB;AAAA,EAAA;;AACd,EAAA,SAAK,EAAL,GAAU,EAAV;AACA,EAAA,SAAK,QAAL,GAAgB,EAAhB;AACA,EAAA,SAAK,MAAL,GAAc,EAAd;AACA,EAAA,SAAK,YAAL,GAAoB,IAAIA,gCAAJ,EAApB;AACD,EAAA;;;;+BAEQ,OAAO;AACd,EAAA,WAAK,QAAL,CAAc,IAAd,CAAmB,KAAnB;AACA,EAAA,YAAM,MAAN,GAAe,IAAf;AACA,EAAA,YAAM,eAAN,IAAyB,MAAM,eAAN,CAAsB,IAAtB,CAAzB;AACD,EAAA;;;yBAEE,WAAW,UAAU;AACtB,EAAA,UAAI,CAAC,KAAK,MAAL,CAAY,SAAZ,CAAL,EAA6B;AAC3B,EAAA,aAAK,MAAL,CAAY,SAAZ,IAAyBC,6BAAW,SAAX,CAAqB,KAAK,EAA1B,EAA8B,SAA9B,EAAyC,KAAzC,EAAzB;AACD,EAAA;;AAED,EAAA,UAAI,QAAJ,EAAc;AACZ,EAAA,eAAO,KAAK,MAAL,CAAY,SAAZ,EACJ,MADI,CACG,aAAK;AACX,EAAA,cAAM,KAAK,EAAE,MAAb;AACA,EAAA,cAAI,OAAO,QAAP,KAAoB,QAAxB,EAAkC;AAChC,EAAA,mBAAO,GAAG,OAAH,CAAW,QAAX,CAAP;AACD,EAAA,WAFD,MAEO;AACL,EAAA,mBAAO,OAAO,QAAd;AACD,EAAA;AACF,EAAA,SARI,CAAP;AASD,EAAA,OAVD,MAUO;AACL,EAAA,eAAO,KAAK,MAAL,CAAY,SAAZ,CAAP;AACD,EAAA;AACF,EAAA;;;gCAES;AACR,EAAA,WAAK,QAAL,CAAc,OAAd,CAAsB,iBAAS;AAC7B,EAAA,YAAI,MAAM,OAAV,EAAmB;AACjB,EAAA,gBAAM,OAAN;AACA,EAAA,gBAAM,MAAN,GAAe,IAAf;AACD,EAAA;AACF,EAAA,OALD;AAMA,EAAA,WAAK,QAAL,GAAgB,IAAhB;;AAEA,EAAA,UAAI,KAAK,EAAT,EAAa;AACX,EAAA,aAAK,EAAL,CAAQ,WAAR;AACA,EAAA,aAAK,EAAL,GAAU,IAAV;AACD,EAAA;AACD,EAAA,WAAK,YAAL,CAAkB,WAAlB;AACA,EAAA,WAAK,YAAL,GAAoB,IAApB;AACD,EAAA;;;;;MAGG;;;;;;;;;;8BACI,aAAa;AAAA,EAAA;;AACnB,EAAA,UAAI,OAAO,IAAX;AACA,EAAA,UAAI,OAAO,IAAX;;AAEA,EAAA,WAAK,kBAAL,GAA0B,KAAK,MAAL,GACvB,SADuB,CACb,mBAAW;AACpB,EAAA,YAAI,IAAJ,EAAU;AACR,EAAA,cAAM,UAAU,KAAK,IAAL,EAAW,OAAX,CAAhB;AACA,EAAA,iBAAO,MAAM,IAAN,EAAY,OAAZ,CAAP;AACA,EAAA,iBAAO,OAAP;AACD,EAAA,SAJD,MAIO;AACL,EAAA,iBAAO,OAAP;AACA,EAAA,iBAAO,cAAc,IAAd,EAAoB,EAAE,UAAU,OAAO,QAAnB,EAApB,CAAP;AACA,EAAA,cAAM,KAAK,eAAe,OAAK,EAA/B;AACA,EAAA,aAAG,SAAH,GAAe,EAAf;AACA,EAAA,aAAG,WAAH,CAAe,IAAf;AACD,EAAA;AACF,EAAA,OAbuB,CAA1B;AAcD,EAAA;;;kCAEW;AACV,EAAA,UAAI,KAAK,kBAAT,EAA6B;AAC3B,EAAA,aAAK,kBAAL,CAAwB,WAAxB;AACA,EAAA,aAAK,kBAAL,GAA0B,IAA1B;AACD,EAAA;AACF,EAAA;;;+BAEQ;AACP,EAAA,aAAOA,6BAAW,EAAX,CAAc,EAAE,KAAF,CAAd,CAAP;AACD,EAAA;;;gCAES;AACR,EAAA;AACA,EAAA,WAAK,SAAL;AACD,EAAA;;;IAnC+B,cAsClC;;MCrGM;AACJ,EAAA,oBAAY,KAAZ,EAAmB,MAAnB,EAA2B;AAAA,EAAA;;AAAA,EAAA;;AACzB,EAAA,SAAK,OAAL,GAAe,IAAIC,sCAAJ,CAAoB,KAApB,CAAf;AACA,EAAA,QAAI,MAAJ,EAAY;AACV,EAAA,WAAK,gBAAL,GAAwB,OAAO,SAAP,CAAiB;AAAA,EAAA,eAAK,MAAK,KAAL,GAAa,CAAlB;AAAA,EAAA,OAAjB,CAAxB;AACD,EAAA;AACF,EAAA;;;;2BAkBI,OAAO;AACV,EAAA,WAAK,OAAL,CAAa,IAAb,CAAkB,KAAlB;AACD,EAAA;;;4BAEK,QAAO;AACX,EAAA,WAAK,OAAL,CAAa,KAAb,CAAmB,MAAnB;AACD,EAAA;;;iCAEU;AACT,EAAA,WAAK,OAAL,CAAa,QAAb;AACD,EAAA;;;oCAEa;AACZ,EAAA,UAAI,KAAK,gBAAT,EAA2B;AACzB,EAAA,aAAK,gBAAL,CAAsB,WAAtB;AACD,EAAA;AACD,EAAA,WAAK,OAAL,CAAa,QAAb;AACD,EAAA;;;0BAjCW;AACV,EAAA,aAAO,KAAK,OAAL,CAAa,KAApB;AACD,EAAA;wBAES,UAAU;AAClB,EAAA,WAAK,OAAL,CAAa,IAAb,CAAkB,QAAlB;AACD,EAAA;;;0BAEoB;AACnB,EAAA,aAAO,KAAK,OAAL,CAAa,cAApB;AACD,EAAA;;;0BAEgB;AACf,EAAA,aAAO,KAAK,OAAZ;AACD,EAAA;;;MAsBH;;EC3CA,SAAS,UAAT,CAAoB,YAApB,EAAkC;AAChC,EAAA,SAAO,IAAI,QAAJ,CAAa,YAAb,EAA2B,IAA3B,CAAP;AACD,EAAA;;AAEDD,+BAAW,SAAX,CAAqB,UAArB,GAAkC,UAAlC;;MCJM;AACJ,EAAA,uBAAsB;AAAA,EAAA,QAAV,KAAU,yDAAJ,EAAI;AAAA,EAAA;;AACpB,EAAA,SAAK,IAAL,GAAY,OAAO,IAAP,CAAY,KAAZ,CAAZ;AACA,EAAA,SAAK,IAAM,GAAX,IAAkB,KAAlB,EAAyB;AACvB,EAAA,WAAK,GAAL,IAAY,IAAI,QAAJ,CAAa,MAAM,GAAN,CAAb,CAAZ;AACD,EAAA;AACF,EAAA;;;;oCAEa;AACZ,EAAA,WAAK,IAAI,CAAT,IAAc,IAAd,EAAoB;AAClB,EAAA,YAAI,KAAK,cAAL,CAAoB,CAApB,CAAJ,EAA4B;AAC1B,EAAA,cAAI,OAAO,KAAK,CAAL,EAAQ,OAAf,KAA2B,UAA/B,EAA2C;AACzC,EAAA,iBAAK,CAAL,EAAQ,WAAR;AACD,EAAA;AACF,EAAA;AACF,EAAA;AACF,EAAA;;;MAGH;;;;;;;;;"}